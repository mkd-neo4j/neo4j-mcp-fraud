name: generate-search-phrase
description: |
  Guides users through creating Search Phrases for Neo4j Bloom - saved queries that users can
  invoke by typing in the search bar, with optional dynamic parameters.

intent: |
  Help users create saved queries for Bloom that:
  - Start fresh queries (not dependent on current graph selection)
  - Can be static (fixed query) or dynamic (with user-provided parameters)
  - Are invoked by typing in the Bloom search bar
  - Match case-insensitively with autocomplete suggestions
  - Support parameter suggestions from database or custom queries

  Key Difference from Scene Actions:
  - Search Phrases: Start new queries from user-typed input
  - Scene Actions: Use currently selected graph elements as input

expected_patterns:
  - entity: Static Search
    shared_elements: [Account, Transaction, Timestamp]
    anomaly: Fixed queries for common searches (e.g., "Recent high-value transactions")
  - entity: Dynamic Search
    shared_elements: [Customer, Country, Amount]
    anomaly: Parameterized queries with $parameter syntax for flexible filtering
  - entity: Date Range Query
    shared_elements: [Transaction, Timestamp, Account]
    anomaly: Queries filtering by $startDate and $endDate parameters
  - entity: Fraud Detection
    shared_elements: [Customer, SSN, Phone, Email]
    anomaly: Queries to find customers sharing identity attributes

reference_cypher: |
  // Static Search Phrase: Recent high-value transactions
  MATCH (a:Account)-[t:TRANSACTION]->(dest:Account)
  WHERE t.timestamp >= datetime() - duration('P7D')
    AND t.amount > 10000
  RETURN a, t, dest
  ORDER BY t.timestamp DESC
  LIMIT 50

  // Dynamic: Customers from $country with transactions over $amount
  MATCH (c:Customer {nationality: $country})
  MATCH (c)-[:OWNS]->(a:Account)
  MATCH (a)-[t:TRANSACTION]->()
  WHERE t.amount > $amount
  WITH c, a, count(DISTINCT t) AS txCount
  WHERE txCount > 0
  RETURN c, a
  ORDER BY c.customerId
  LIMIT 50

  // Date Range: Transactions between $startDate and $endDate
  MATCH (a:Account)-[t:TRANSACTION]->(dest:Account)
  WHERE t.timestamp >= datetime($startDate)
    AND t.timestamp <= datetime($endDate)
  RETURN a, t, dest
  ORDER BY t.timestamp DESC
  LIMIT 100

  // Threshold: Transactions over $amount
  MATCH (a:Account)-[t:TRANSACTION]->(dest:Account)
  WHERE t.amount >= $amount
  RETURN a, t, dest
  ORDER BY t.amount DESC
  LIMIT 50

  // Path Finding: Connection between $customer1 and $customer2
  MATCH (c1:Customer {customerId: $customer1})
  MATCH (c2:Customer {customerId: $customer2})
  MATCH path = shortestPath((c1)-[*..5]-(c2))
  RETURN path

  // Velocity Analysis: Customers with more than $count transactions in last $days days
  MATCH (c:Customer)-[:OWNS]->(a:Account)
  MATCH (a)-[t:TRANSACTION]->()
  WHERE t.timestamp >= datetime() - duration('P' + $days + 'D')
  WITH c, count(t) AS txCount
  WHERE txCount > $count
  MATCH (c)-[:OWNS]->(a2:Account)
  RETURN c, a2
  LIMIT 50

  // Shared Identity: Customers sharing PII with customer $customerId
  MATCH (suspect:Customer {customerId: $customerId})
  MATCH (suspect)-[:HAS_EMAIL|HAS_PHONE|HAS_SSN]->(pii)
  MATCH (other:Customer)-[:HAS_EMAIL|HAS_PHONE|HAS_SSN]->(pii)
  WHERE suspect <> other
  RETURN suspect, pii, other
  LIMIT 50

  // Parameter Suggestion Query Example (for $country)
  MATCH (c:Customer)
  RETURN DISTINCT c.nationality AS country
  ORDER BY country
  LIMIT 100

reference_schema:
  labels: [Customer, Account, Transaction, Email, Phone, SSN, Address, Product, Order]
  relationships: [OWNS, TRANSACTION, HAS_EMAIL, HAS_PHONE, HAS_SSN, HAS_ADDRESS, PLACED, CONTAINS]

parameters:
  - name: country
    type: string
    description: Country or nationality filter (supports Label-Key suggestions from Customer.nationality)
  - name: amount
    type: number
    description: Transaction amount threshold
  - name: startDate
    type: string
    description: Start date for range queries (ISO 8601 format)
  - name: endDate
    type: string
    description: End date for range queries (ISO 8601 format)
  - name: customerId
    type: string
    description: Customer ID for targeted searches
  - name: count
    type: integer
    description: Threshold count for velocity analysis
  - name: days
    type: integer
    description: Number of days for look-back period
