name: generate-scene-action
description: |
  Guides users through creating Scene Actions for Neo4j Bloom - parameterized Cypher queries
  that use currently selected graph elements as input parameters.

intent: |
  Help users create context-sensitive Cypher queries for Bloom that:
  - Execute against currently selected nodes or relationships in the graph visualization
  - Use selected elements as parameters ($nodes or $relationships)
  - Appear in the right-click context menu when elements are selected
  - Can be limited to specific node labels or relationship types

  Key Difference from Search Phrases:
  - Scene Actions: Use graph elements you've ALREADY selected as input
  - Search Phrases: Start fresh queries from user-typed parameters

expected_patterns:
  - entity: Node Selection
    shared_elements: [Account, Customer, Transaction]
    anomaly: Expand related nodes from selected entities using $nodes parameter
  - entity: Relationship Selection
    shared_elements: [TRANSACTION, OWNS, HAS_EMAIL]
    anomaly: Analyze or expand from selected relationships using $relationships parameter
  - entity: Fraud Detection
    shared_elements: [Customer, SSN, Phone, Email, Address]
    anomaly: Find other customers sharing identity attributes with selected customer(s)

reference_cypher: |
  // Node-Based Scene Action (Neo4j 5+)
  MATCH (n:NodeLabel)
  WHERE elementId(n) IN $nodes
  // ... rest of query
  RETURN ...

  // Expand Related Nodes
  MATCH (a:Account)
  WHERE elementId(a) IN $nodes
  MATCH (a)<-[:OWNS]-(c:Customer)
  MATCH (c)-[:HAS_EMAIL]->(e:Email)
  RETURN a, c, e

  // Find High-Value Transactions
  MATCH (a:Account)
  WHERE elementId(a) IN $nodes
  MATCH (a)-[t:TRANSACTION]->(dest:Account)
  WHERE t.amount > 10000
  RETURN a, t, dest
  ORDER BY t.amount DESC
  LIMIT 50

  // Fraud Detection - Shared PII
  MATCH (suspect:Customer)
  WHERE elementId(suspect) IN $nodes
  MATCH (suspect)-[:HAS_EMAIL|HAS_PHONE|HAS_SSN]->(pii)
  MATCH (other:Customer)-[:HAS_EMAIL|HAS_PHONE|HAS_SSN]->(pii)
  WHERE suspect <> other
  RETURN suspect, pii, other
  LIMIT 50

  // Multi-Hop Path Finding
  MATCH (start:Customer)
  WHERE elementId(start) IN $nodes
  MATCH (end:Customer)
  WHERE elementId(end) IN $nodes AND start <> end
  MATCH path = shortestPath((start)-[*..5]-(end))
  RETURN path

  // Write Operation - Flag for Review
  MATCH (a:Account)
  WHERE elementId(a) IN $nodes
  SET a.flagged = true,
      a.flaggedDate = datetime(),
      a.flaggedReason = 'Manual review requested'
  RETURN a

reference_schema:
  labels: [Customer, Account, Transaction, Email, Phone, SSN, Address]
  relationships: [OWNS, TRANSACTION, HAS_EMAIL, HAS_PHONE, HAS_SSN, HAS_ADDRESS]

parameters:
  - name: nodes
    type: array
    description: Array of element IDs for selected nodes (provided by Bloom)
  - name: relationships
    type: array
    description: Array of element IDs for selected relationships (provided by Bloom)
