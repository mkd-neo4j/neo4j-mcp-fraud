name: get-customer-profile
description: |
  Retrieves comprehensive customer profile information from the graph database.

intent: |
  Gather complete customer identity, contact information, and relationship data for:
  - Customer service: Full account and contact details for customer inquiries
  - KYC/CDD: Identity verification, document validation, and customer onboarding
  - Compliance audits: Review customer information completeness and accuracy
  - Fraud investigation: Comprehensive profile gathering for suspicious activity investigation

expected_patterns:
  - entity: Customer
    shared_elements: [Email, Phone, Address, SSN, DriverLicense, Passport, Account]
    anomaly: Missing or incomplete identity data that could indicate synthetic identity or data quality issues

reference_cypher: |
  MATCH (c:Customer {customerId: $customerId})

  // Contact information
  OPTIONAL MATCH (c)-[:HAS_EMAIL]->(e:Email)
  OPTIONAL MATCH (c)-[:HAS_PHONE]->(p:Phone)
  OPTIONAL MATCH (c)-[:HAS_ADDRESS]->(a:Address)

  // Identity documents
  OPTIONAL MATCH (c)-[:HAS_SSN]->(s:SSN)
  OPTIONAL MATCH (c)-[:HAS_DRIVER_LICENSE]->(dl:DriverLicense)
  OPTIONAL MATCH (c)-[:HAS_PASSPORT]->(pp:Passport)

  // Accounts
  OPTIONAL MATCH (c)-[:OWNS]->(acc:Account)

  RETURN {
    base_details: {
      customerId: c.customerId,
      firstName: c.firstName,
      lastName: c.lastName,
      dateOfBirth: c.dateOfBirth,
      nationality: c.nationality,
      customerType: c.customerType,
      createdAt: c.createdAt
    },
    contact_information: {
      emails: collect(DISTINCT {address: e.address, verified: e.verified, primary: e.primary}),
      phones: collect(DISTINCT {number: p.number, type: p.type, primary: p.primary}),
      addresses: collect(DISTINCT {street: a.street, city: a.city, state: a.state, zip: a.zip, country: a.country, type: a.type})
    },
    identity_documents: {
      ssn: collect(DISTINCT {number: s.number}),
      driverLicense: collect(DISTINCT {number: dl.number, state: dl.state, expiryDate: dl.expiryDate}),
      passport: collect(DISTINCT {number: pp.number, country: pp.country, expiryDate: pp.expiryDate})
    },
    account_information: {
      accounts: collect(DISTINCT {accountNumber: acc.accountNumber, accountType: acc.accountType, status: acc.status, balance: acc.balance})
    }
  } as profile

reference_schema:
  labels: [Customer, Email, Phone, Address, SSN, DriverLicense, Passport, Account]
  relationships: [HAS_EMAIL, HAS_PHONE, HAS_ADDRESS, HAS_SSN, HAS_DRIVER_LICENSE, HAS_PASSPORT, OWNS]

parameters:
  - name: customerId
    type: string
    required: true
    description: The customer ID to retrieve the profile for
