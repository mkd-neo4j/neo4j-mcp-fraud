name: define-proceeds-of-crime
description: |
  Guides a 7-phase user-controlled workflow for defining "proceeds of crime" for SAR Section 2.2.

intent: |
  Ensure 100% user control when classifying transactions as proceeds of crime:
  - User explicitly classifies which transactions are proceeds (direct and indirect)
  - User provides reasoning for inclusion/exclusion decisions
  - User confirms final quantum calculation
  - Complete audit trail of all decisions
  - No automated assumptions about proceeds

  Legal Foundation (POCA 2002):
  - Direct proceeds: Money flowing in ONE step from criminal act
  - Indirect proceeds: Money flowing through MULTIPLE hops (layering)

expected_patterns:
  - entity: Transaction
    shared_elements: [Account, Customer, Amount, Timestamp]
    anomaly: Direct proceeds - payment directly from victim to criminal's account
  - entity: Transaction Chain
    shared_elements: [Account, Amount, Timestamp]
    anomaly: Indirect proceeds (layering) - funds moving through intermediary accounts to obscure origin
  - entity: Exclusion
    shared_elements: [Account, Creditor, Business Purpose]
    anomaly: Legitimate third-party payments that are NOT proceeds (debts, utilities, etc.)

reference_cypher: |
  // Phase 2: Retrieve all transactions in investigation scope
  MATCH (c:Customer {customerId: $customerId})-[:OWNS]->(a:Account)
  MATCH (a)-[t:TRANSACTION]-(other:Account)
  WHERE t.timestamp >= datetime($startDate)
    AND t.timestamp <= datetime($endDate)
  RETURN t, a, other
  ORDER BY t.timestamp

  // Phase 4: Trace indirect proceeds (money flows from direct proceeds)
  MATCH path = (source:Account)-[:TRANSACTION*1..$maxHops]->(dest:Account)
  WHERE source.accountNumber IN $directProceedsAccounts
  RETURN path, nodes(path) AS accounts,
         [rel IN relationships(path) | rel] AS transactions

  // Phase 6: Calculate quantum (sum method)
  WITH $directProceedsTransactions AS direct, $indirectProceedsTransactions AS indirect
  RETURN {
    directProceeds: reduce(sum = 0.0, tx IN direct | sum + tx.amount),
    indirectProceeds: reduce(sum = 0.0, tx IN indirect | sum + tx.amount),
    totalProceeds: reduce(sum = 0.0, tx IN direct + indirect | sum + tx.amount)
  } AS quantum

reference_schema:
  labels: [Customer, Account, Transaction]
  relationships: [OWNS, TRANSACTION, PERFORMS, BENEFITS_TO]

parameters:
  - name: customerId
    type: string
    required: true
    description: Customer ID of the suspect
  - name: startDate
    type: string
    required: true
    description: Start date of investigation period (ISO 8601)
  - name: endDate
    type: string
    required: true
    description: End date of investigation period (ISO 8601)
  - name: maxHops
    type: integer
    default: 5
    description: Maximum hops for tracing indirect proceeds (layering depth)
  - name: directProceedsAccounts
    type: array
    description: Account numbers containing direct proceeds (for Phase 4 tracing)
  - name: directProceedsTransactions
    type: array
    description: Transaction objects classified as direct proceeds (for Phase 6 quantum)
  - name: indirectProceedsTransactions
    type: array
    description: Transaction objects classified as indirect proceeds (for Phase 6 quantum)
